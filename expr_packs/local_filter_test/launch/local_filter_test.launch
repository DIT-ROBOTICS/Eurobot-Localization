<launch>

    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_velocity_odom" clear_params="true">
        <!-- <param name="tf_prefix" value="Tera" /> -->
        <rosparam command="load" file="$(find local_filter_test)/param/local_filter_test_odom.yaml" />
        <remap from="odometry/filtered" to="local_filter_test_odom" />
        <remap from="set_pose" to="initialpose" />
        <remap from="/diagnostics" to="~diagnostics" />
    </node>

    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_velocity_imu" clear_params="true">
        <!-- <param name="tf_prefix" value="Tera" /> -->
        <rosparam command="load" file="$(find local_filter_test)/param/local_filter_test__imu.yaml" />
        <remap from="odometry/filtered" to="local_filter_test_imu" />
        <remap from="set_pose" to="initialpose" />
        <remap from="/diagnostics" to="~diagnostics" />
    </node>

    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_velocity_all" clear_params="true">
        <!-- <param name="tf_prefix" value="Tera" /> -->
        <rosparam command="load" file="$(find local_filter_test)/param/local_filter_test_all.yaml" />
        <remap from="odometry/filtered" to="local_filter_test_all" />
        <remap from="set_pose" to="initialpose" />
        <remap from="/diagnostics" to="~diagnostics" />
    </node>

    <!-- Odometry firmware and covariance feedback loop node (contain communication) -->
    <include file="$(find odometry)/launch/odometry_comm.launch">
        <arg name="robot_name" value="$(arg robot_name)"/>
        <arg name="robot_name_slash" value="$(arg robot_name_slash)"/>
    </include>

    <!-- IMU firmware and covariance feedback loop node (contain IMU spatial launch) -->
    <include file="$(find imu_drive)/launch/imu_drive_firm.launch">
        <arg name="robot_name" value="$(arg robot_name)"/>
        <arg name="robot_name_slash" value="$(arg robot_name_slash)"/>
    </include>

    <!-- P_control test -->
        
    <node pkg="p_control" type="p_control_node" name="p_control_node" output="screen">
        <param name="active" value="true"/>
        <param name="publish" value="true"/>
        <param name="sub_topic" value="/$(arg robot_name)/global_filter"/>
        <param name="pub_topic" value="/$(arg robot_name)/cmd_vel"/>
        <param name="update_params" value="false"/>
        <param name="goal_x" value="1.0"/>
        <param name="goal_y" value="0.0"/>
        <param name="goal_yaw" value="0.0"/>
        <param name="goal_round" value="5.0"/>
        <param name="max_linear_vel" value="0.2"/>
        <param name="max_angular_vel" value="0.6"/>
        <param name="min_angular_vel" value="0.4"/>
        <param name="angular_accel" value="0.002"/>
        <param name="with_p_control" value="true"/>
        <param name="using_orientation_data" value="true"/>
        <param name="using_linear_data" value="false"/>
    </node>

</launch>